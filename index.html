<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beast Feast - –ü–æ–≤–Ω–∞ –∫—É–ª—ñ–Ω–∞—Ä–Ω–∞ —Å–∏—Å—Ç–µ–º–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6 border-l-4 border-amber-500">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-amber-800 mb-2">üçñ Beast Feast - –ü–æ–≤–Ω–∞ –∫—É–ª—ñ–Ω–∞—Ä–Ω–∞ —Å–∏—Å—Ç–µ–º–∞</h1>
                    <p class="text-gray-600">–ö—É–ª—ñ–Ω–∞—Ä–Ω—ñ –ø—Ä–∏–≥–æ–¥–∏ –¥–ª—è Daggerheart –∑ –ø–æ–≤–Ω–∏–º –Ω–∞–±–æ—Ä–æ–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤</p>
                </div>
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="rollCount">0</div>
                        <div class="text-xs text-gray-500">–ö–∏–¥–∫—ñ–≤</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="successCount">0</div>
                        <div class="text-xs text-gray-500">–°—Ç—Ä–∞–≤</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="avgRating">0</div>
                        <div class="text-xs text-gray-500">–°–µ—Ä. —Ä–µ–π—Ç–∏–Ω–≥</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600" id="totalIngredients">0</div>
                        <div class="text-xs text-gray-500">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex flex-wrap border-b">
                <button onclick="switchTab('cooking')" class="tab-button px-6 py-3 border-b-2 border-amber-500 text-amber-600 font-semibold">
                    üç≥ –ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è
                </button>
                <button onclick="switchTab('ingredients')" class="tab-button px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
                    ü•Ñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
                </button>
                <button onclick="switchTab('inventory')" class="tab-button px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
                    üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä –≥—Ä—É–ø–∏
                </button>
                <button onclick="switchTab('cookbook')" class="tab-button px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
                    üìñ –ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞
                </button>
                <button onclick="switchTab('rules')" class="tab-button px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
                    üìö –ü—Ä–∞–≤–∏–ª–∞
                </button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è -->
            <div id="cooking" class="tab-content active p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">üç≥ –ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è –ø–∏—Ä—É</h2>
                
                <!-- –ü–æ—Ç–æ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –≥—Ä—É–ø–∏ -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-purple-800">–†—ñ–≤–µ–Ω—å –≥—Ä—É–ø–∏</h3>
                            <p class="text-sm text-purple-600">–í–∏–∑–Ω–∞—á–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∂–µ—Ç–æ–Ω—ñ–≤ –¥–æ—Å–≤—ñ–¥—É –∑–∞ –∑–Ω–∞–π–æ–º—ñ —Ä–µ—Ü–µ–ø—Ç–∏</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="adjustGroupLevel(-1)" class="w-8 h-8 bg-purple-200 hover:bg-purple-300 rounded text-purple-800">-</button>
                            <span class="text-2xl font-bold text-purple-800 w-12 text-center" id="groupLevel">1</span>
                            <button onclick="adjustGroupLevel(1)" class="w-8 h-8 bg-purple-200 hover:bg-purple-300 rounded text-purple-800">+</button>
                        </div>
                    </div>
                </div>

                <!-- –Ü–Ω–ø—É—Ç–∏ –¥–ª—è —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-pink-400 rounded-full mr-2"></span>
                            üçØ –°–æ–ª–æ–¥–∫–∏–π (–∫4):
                        </label>
                        <div class="relative">
                            <input type="number" id="sweet" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('sweet', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('sweet', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-blue-400 rounded-full mr-2"></span>
                            üßÇ –°–æ–ª–æ–Ω–∏–π (–∫6):
                        </label>
                        <div class="relative">
                            <input type="number" id="salty" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('salty', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('salty', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-green-600 rounded-full mr-2"></span>
                            üåø –ì—ñ—Ä–∫–∏–π (–∫8):
                        </label>
                        <div class="relative">
                            <input type="number" id="bitter" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('bitter', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('bitter', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-yellow-400 rounded-full mr-2"></span>
                            üçã –ö–∏—Å–ª–∏–π (–∫10):
                        </label>
                        <div class="relative">
                            <input type="number" id="sour" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('sour', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('sour', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                            üå∂Ô∏è –ü—Ä—è–Ω–∏–π (–∫12):
                        </label>
                        <div class="relative">
                            <input type="number" id="savory" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('savory', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('savory', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ingredient-input">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-purple-600 rounded-full mr-2"></span>
                            üîÆ –î–∏–≤–∞–∫—É–≤–∞—Ç–∏–π (–∫20):
                        </label>
                        <div class="relative">
                            <input type="number" id="weird" min="0" max="20" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('weird', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('weird', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <span class="inline-block w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
                            ü™ô –ñ–µ—Ç–æ–Ω–∏ –¥–æ—Å–≤—ñ–¥—É:
                        </label>
                        <div class="relative">
                            <input type="number" id="token" min="0" max="50" value="0" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex space-x-1">
                                <button onclick="adjustInput('token', -1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">-</button>
                                <button onclick="adjustInput('token', 1)" class="w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded text-xs">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è —Ç–∞ –∫–Ω–æ–ø–∫–∏ -->
                <div id="prediction" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg hidden">
                    <p class="text-blue-800 text-sm"></p>
                </div>
                
                <div class="flex space-x-3 mb-6">
                    <button onclick="startCooking()" class="flex-1 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 transform hover:scale-105">
                        üç≥ –ü—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏ –ø–∏—Ä
                    </button>
                    <button onclick="loadFromInventory()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg">
                        üì¶ –ó —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è
                    </button>
                    <button onclick="clearCookingInputs()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏
                    </button>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–æ—Ç—É–≤–∞–Ω–Ω—è -->
                <div id="cookingResults" class="hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è</h3>
                    <div id="cookingOutput" class="space-y-4"></div>
                </div>

                <!-- –†–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–π—Ç–∏–Ω–≥—É —Å—Ç—Ä–∞–≤–∏ -->
                <div id="mealDistribution" class="hidden mt-6 p-6 bg-green-50 border border-green-200 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-800 mb-4">üçΩÔ∏è –†–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–π—Ç–∏–Ω–≥—É —Å—Ç—Ä–∞–≤–∏</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–†–µ–π—Ç–∏–Ω–≥ —Å—Ç—Ä–∞–≤–∏:</label>
                            <input type="number" id="totalMealRating" readonly class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‚ù§Ô∏è –õ—ñ–∫—É–≤–∞–Ω–Ω—è —Ä–∞–Ω:</label>
                            <input type="number" id="healingPoints" min="0" value="0" onchange="updateDistribution()" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üò∞ –ó–Ω—è—Ç—Ç—è —Å—Ç—Ä–µ—Å—É:</label>
                            <input type="number" id="stressRelief" min="0" value="0" onchange="updateDistribution()" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‚ú® –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–¥—ñ—ó:</label>
                            <input type="number" id="hopeGain" min="0" value="0" onchange="updateDistribution()" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ: <span id="usedPoints">0</span> / <span id="availablePoints">0</span>
                        </div>
                        <button onclick="saveMealDistribution()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª
                        </button>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ -->
            <div id="ingredients" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">ü•Ñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑—ñ –∑–≤—ñ—Ä—ñ–≤ -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-red-800 mb-4">üêª –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑—ñ –∑–≤—ñ—Ä—ñ–≤</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ —Ä–∞–Ω–∏ –∑–≤—ñ—Ä–∞:</label>
                                <input type="number" id="beastWounds" min="1" max="20" value="4" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <div class="text-xs text-gray-500 mt-1">
                                    1-4 —Ä–∞–Ω–∏ = 1 —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç | 5-7 = 2 | 8-10 = 3 | 12+ = 4
                                </div>
                            </div>
                            
                            <div id="beastIngredientCount" class="text-sm font-medium text-red-700">
                                –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤: 1
                            </div>
                            
                            <button onclick="generateBeastIngredients()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                                üé≤ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑—ñ –∑–≤—ñ—Ä–∞
                            </button>
                            
                            <div id="beastIngredientsResult" class="space-y-2"></div>
                        </div>
                    </div>

                    <!-- –ö–≤—ñ—Ç–∏ –∑ –¥–æ–≤–∫—ñ–ª–ª—è -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-green-800 mb-4">üå∏ –ö–≤—ñ—Ç–∏ –∑ –¥–æ–≤–∫—ñ–ª–ª—è</h3>
                        <div class="space-y-4">
                            <div class="text-sm text-gray-700">
                                <p>–û–¥–∏–Ω —Ä–∞–∑ –º—ñ–∂ –≤—ñ–¥–ø–æ—á–∏–Ω–∫–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ 1 –ù–∞–¥—ñ—é –¥–ª—è –∑–±–æ—Ä—É "–∫–≤—ñ—Ç—ñ–≤".</p>
                            </div>
                            
                            <button onclick="generateFlowerIngredient()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                                ‚ú® –í–∏—Ç—Ä–∞—Ç–∏—Ç–∏ –Ω–∞–¥—ñ—é –Ω–∞ –∑–±—ñ—Ä –∫–≤—ñ—Ç—ñ–≤
                            </button>
                            
                            <div id="flowerIngredientResult" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- –†—É—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞ -->
                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">‚úèÔ∏è –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–π —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞:</label>
                            <input type="text" id="customIngredientName" placeholder="–ù–∞–∑–≤–∞..." class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–¢–∏–ø:</label>
                            <select id="customIngredientType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="beast">üêª –ó—ñ –∑–≤—ñ—Ä–∞</option>
                                <option value="flower">üå∏ –ö–≤—ñ—Ç–∫–∞</option>
                                <option value="special">‚≠ê –û—Å–æ–±–ª–∏–≤–∏–π</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üçØ –°–æ–ª–æ–¥–∫–∏–π:</label>
                            <input type="number" id="customSweet" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üßÇ –°–æ–ª–æ–Ω–∏–π:</label>
                            <input type="number" id="customSalty" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üåø –ì—ñ—Ä–∫–∏–π:</label>
                            <input type="number" id="customBitter" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üçã –ö–∏—Å–ª–∏–π:</label>
                            <input type="number" id="customSour" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üå∂Ô∏è –ü—Ä—è–Ω–∏–π:</label>
                            <input type="number" id="customSavory" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">üîÆ –î–∏–≤–∞–∫—É–≤–∞—Ç–∏–π:</label>
                            <input type="number" id="customWeird" min="0" max="3" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">–û—Å–æ–±–ª–∏–≤–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                        <textarea id="customIngredientProperty" placeholder="–û–ø–∏—à—ñ—Ç—å –æ—Å–æ–±–ª–∏–≤—É –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å..." class="w-full px-3 py-2 border border-gray-300 rounded-md h-20 resize-none"></textarea>
                    </div>
                    
                    <button onclick="createCustomIngredient()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        ‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç
                    </button>
                </div>

                <!-- –í–∏–ø–∞–¥–∫–æ–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ -->
                <div class="mt-6 bg-purple-50 border border-purple-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">‚ú® –û—Å–æ–±–ª–∏–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h3>
                    <button onclick="generateIngredientProperty()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg mb-4">
                        üé≠ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –æ—Å–æ–±–ª–∏–≤—É –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å
                    </button>
                    <div id="ingredientPropertyResult"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
            <div id="inventory" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä –≥—Ä—É–ø–∏</h2>
                
                <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂—ñ -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üë• –ü–µ—Ä—Å–æ–Ω–∞–∂—ñ –≥—Ä—É–ø–∏</h3>
                        <button onclick="addCharacter()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            ‚ûï –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                        </button>
                    </div>
                    <div id="charactersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- –ó–∞–≥–∞–ª—å–Ω–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">üì¶ –ó–∞–≥–∞–ª—å–Ω–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h3>
                        <div class="flex space-x-2">
                            <button onclick="clearInventory()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ
                            </button>
                            <button onclick="loadFromInventory()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                                üç≥ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –≥–æ—Ç—É–≤–∞–Ω–Ω—è
                            </button>
                        </div>
                    </div>
                    <div id="groupInventory" class="space-y-2">
                        <p class="text-gray-500 italic">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç –ø—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</p>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏ -->
            <div id="cookbook" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìñ –ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞ –≥—Ä—É–ø–∏</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- –®–≤–∏–¥–∫—ñ —Ä–µ—Ü–µ–ø—Ç–∏ -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">üçΩÔ∏è –®–≤–∏–¥–∫—ñ —Ä–µ—Ü–µ–ø—Ç–∏</h3>
                        <div class="space-y-2">
                            <button onclick="loadQuickRecipe('simple')" class="w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200">
                                <div class="font-medium text-green-800">–ü—Ä–æ—Å—Ç–∏–π —Å—É–ø</div>
                                <div class="text-sm text-green-600">üßÇ –°–æ–ª–æ–Ω–∏–π(1) + üå∂Ô∏è –ü—Ä—è–Ω–∏–π(2)</div>
                            </button>
                            <button onclick="loadQuickRecipe('mushroom')" class="w-full text-left p-3 bg-orange-50 hover:bg-orange-100 rounded-lg border border-orange-200">
                                <div class="font-medium text-orange-800">–ì—Ä–∏–±–Ω—ñ —à–∞–ø–∫–∏</div>
                                <div class="text-sm text-orange-600">üåø –ì—ñ—Ä–∫–∏–π(1) + üå∂Ô∏è –ü—Ä—è–Ω–∏–π(2)</div>
                            </button>
                            <button onclick="loadQuickRecipe('wyvern')" class="w-full text-left p-3 bg-purple-50 hover:bg-purple-100 rounded-lg border border-purple-200">
                                <div class="font-medium text-purple-800">–Ø–∑–∏–∫ –≤—ñ–≤—Ä–µ–Ω–∏</div>
                                <div class="text-sm text-purple-600">üçã üå∂Ô∏è üîÆ (–ø–æ 1)</div>
                            </button>
                        </div>
                    </div>

                    <!-- –ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ -->
                    <div class="lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">üìã –ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏</h3>
                            <button onclick="exportCookbook()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                                üíæ –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∫–Ω–∏–≥—É
                            </button>
                        </div>
                        <div id="savedRecipes" class="space-y-3 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 italic">–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–∞–≤–∏–ª -->
            <div id="rules" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìö –ü–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ Beast Feast</h2>
                
                <div class="space-y-6 prose max-w-none">
                    <!-- –ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞ –≥—Ä—É–ø–∏ -->
                    <div class="border-l-4 border-pink-500 pl-4">
                        <h3 class="text-lg font-semibold text-pink-800 mb-2">üìñ –ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞ –≥—Ä—É–ø–∏</h3>
                        <div class="bg-pink-50 p-4 rounded-lg">
                            <p class="text-gray-700 mb-2">
                                –£ —Ö–æ–¥—ñ —Ü—ñ—î—ó –∫–∞–º–ø–∞–Ω—ñ—ó –≤–∞—à—ñ –≥—Ä–∞–≤—Ü—ñ —Ä–∞–∑–æ–º —Å–∫–ª–∞–¥—É—Ç—å –∫—É–ª—ñ–Ω–∞—Ä–Ω—É –∫–Ω–∏–≥—É —Ä–µ—Ü–µ–ø—Ç—ñ–≤. –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π—Ç–µ —ó–º –≤–∏–±—Ä–∞—Ç–∏ –Ω–µ–≤–µ–ª–∏–∫–∏–π –±–ª–æ–∫–Ω–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å—ñ–≤, —è–∫–∏–π –º–æ–∂–Ω–∞ –±—É–¥–µ –ø—Ä–∏–∫—Ä–∞—Å–∏—Ç–∏ –∑–∞ —Å–≤–æ—ó–º —Å–º–∞–∫–æ–º ‚Äî —Å—Ç—ñ–∫–µ—Ä–∞–º–∏, —Ñ–∞—Ä–±–∞–º–∏, –∫–æ–ª—å–æ—Ä–æ–≤–∏–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏, —á–∏–º –∑–∞–≤–≥–æ–¥–Ω–æ!
                            </p>
                            <p class="text-gray-700 mb-2">
                                –¶–µ–π –±–ª–æ–∫–Ω–æ—Ç —ñ —Å—Ç–∞–Ω–µ —ó—Ö–Ω—å–æ—é —Å–ø—ñ–ª—å–Ω–æ—é –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—é –∫–Ω–∏–≥–æ—é. –ü—ñ–¥ —á–∞—Å –ø—Ä–∏–≤–∞–ª—É –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –∑–∞–Ω–æ—Å–∏—Ç–∏ —Ç—É–¥–∏ –∫–æ–∂–µ–Ω —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç, –≤–∫–∞–∑—É—é—á–∏ –Ω–∞–∑–≤—É, –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏, –º–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
                            </p>
                            <p class="text-gray-700">
                                <strong>–í–∞–∂–ª–∏–≤–æ:</strong> –ß–∏–º —á–∞—Å—Ç—ñ—à–µ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É—é—Ç—å –∑ –ø–µ–≤–Ω–∏–º–∏ —Å–º–∞–∫–∞–º–∏ —Ç–∞ –ø–æ—î–¥–Ω–∞–Ω–Ω—è–º–∏, —Ç–∏–º –ø—Ä–æ—Å—Ç—ñ—à–µ —ó–º –±—É–¥–µ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ü—ñ –∫—É–ª—ñ–Ω–∞—Ä–Ω—ñ —à–µ–¥–µ–≤—Ä–∏ –Ω–∞–¥–∞–ª—ñ!
                            </p>
                        </div>
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">üéØ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-gray-700 mb-2">
                                –ü—ñ–¥ —á–∞—Å –ø—Ä–∏–≤–∞–ª—É –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ –≤—ñ–¥–Ω–æ–≤–ª—é—é—Ç—å —Å–∏–ª–∏, –≥–æ—Ç—É—é—á–∏ —ó–∂—É –∑ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤, –∑–¥–æ–±—É—Ç–∏—Ö —É –ø—ñ–¥–∑–µ–º–µ–ª–ª—è—Ö.
                            </p>
                            <ul class="text-gray-700 ml-4 space-y-1">
                                <li>‚Ä¢ –ö–æ–∂–µ–Ω —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Å–º–∞–∫–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å (1-3 —Å–º–∞–∫–∏)</li>
                                <li>‚Ä¢ –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å —Å–º–∞–∫—É (1-3) = –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—É–±–∏–∫—ñ–≤ –¥–ª—è –∫–∏–¥–∞–Ω–Ω—è</li>
                                <li>‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ –Ω–µ—Å—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ = –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–π–≤–∏—â–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞</li>
                                <li>‚Ä¢ –ú–µ—Ç–∞: –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–±—ñ–≥–∏ –ø—Ä–∏ –∫–∏–¥–∞–Ω–Ω—ñ –∫—É–±–∏–∫—ñ–≤ —Å–º–∞–∫—É</li>
                            </ul>
                        </div>
                    </div>

                    <!-- –°–º–∞–∫–∏ —Ç–∞ –∫—É–±–∏–∫–∏ -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="text-lg font-semibold text-green-800 mb-2">üé≤ –°–º–∞–∫–∏ —Ç–∞ –∫—É–±–∏–∫–∏</h3>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div>üçØ –°–æ–ª–æ–¥–∫–∏–π (–∫4)</div>
                                <div>üßÇ –°–æ–ª–æ–Ω–∏–π (–∫6)</div>
                                <div>üåø –ì—ñ—Ä–∫–∏–π (–∫8)</div>
                                <div>üçã –ö–∏—Å–ª–∏–π (–∫10)</div>
                                <div>üå∂Ô∏è –ü—Ä—è–Ω–∏–π (–∫12)</div>
                                <div>üîÆ –î–∏–≤–∞–∫—É–≤–∞—Ç–∏–π (–∫20)</div>
                            </div>
                        </div>
                    </div>

                    <!-- –ó–±—ñ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ -->
                    <div class="border-l-4 border-orange-500 pl-4">
                        <h3 class="text-lg font-semibold text-orange-800 mb-2">ü¶å –ó–±—ñ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h3>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="space-y-3">
                                <div>
                                    <h4 class="font-semibold text-orange-800">–ó—ñ –∑–≤—ñ—Ä—ñ–≤:</h4>
                                    <ul class="text-gray-700 ml-4 text-sm">
                                        <li>‚Ä¢ 4 —Ä–∞–Ω–∏ –∞–±–æ –º–µ–Ω—à–µ: 1 —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</li>
                                        <li>‚Ä¢ 5-7 —Ä–∞–Ω: 2 —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</li>
                                        <li>‚Ä¢ 8-10 —Ä–∞–Ω: 3 —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</li>
                                        <li>‚Ä¢ 12 —Ä–∞–Ω —ñ –≤–∏—â–µ: 4 —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-orange-800">"–ö–≤—ñ—Ç–∏" –∑ –¥–æ–≤–∫—ñ–ª–ª—è:</h4>
                                    <p class="text-gray-700 text-sm">–û–¥–∏–Ω —Ä–∞–∑ –º—ñ–∂ –≤—ñ–¥–ø–æ—á–∏–Ω–∫–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ 1 –ù–∞–¥—ñ—é –¥–ª—è –∑–±–æ—Ä—É –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="text-lg font-semibold text-purple-800 mb-2">üç≥ –ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è –ø–∏—Ä—É</h3>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <ol class="text-gray-700 space-y-2">
                                <li><strong>1.</strong> –û–±–µ—Ä—ñ—Ç—å —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —Ç–∞ –∫–∏–Ω—å—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫—É–±–∏–∫–∏ —Å–º–∞–∫—É</li>
                                <li><strong>2.</strong> –®—É–∫–∞–π—Ç–µ –∑–±—ñ–≥–∏ (–æ–¥–Ω–∞–∫–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –∫—É–±–∏–∫–∞—Ö)</li>
                                <li><strong>3.</strong> –Ø–∫—â–æ —î –∑–±—ñ–≥–∏ - –≤—ñ–¥–∫–ª–∞–¥—ñ—Ç—å —Ü—ñ –∫—É–±–∏–∫–∏</li>
                                <li><strong>4.</strong> –Ø–∫—â–æ –Ω–µ–º–∞—î - –ø—Ä–∏–±–µ—Ä—ñ—Ç—å –æ–¥–∏–Ω –∫—É–±–∏–∫/–≤–∏—Ç—Ä–∞—Ç—å—Ç–µ –∂–µ—Ç–æ–Ω</li>
                                <li><strong>5.</strong> –ü–æ–≤—Ç–æ—Ä—é–π—Ç–µ –¥–æ –æ–¥–Ω–æ–≥–æ –∫—É–±–∏–∫–∞</li>
                                <li><strong>6.</strong> –ü—ñ–¥—Ä–∞—Ö—É–π—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥ —Å—Ç—Ä–∞–≤–∏ (—Å—É–º–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∑–±—ñ–≥—ñ–≤)</li>
                            </ol>
                        </div>
                    </div>

                    <!-- –†–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–π—Ç–∏–Ω–≥—É -->
                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="text-lg font-semibold text-red-800 mb-2">üçΩÔ∏è –†–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–π—Ç–∏–Ω–≥—É —Å—Ç—Ä–∞–≤–∏</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-gray-700 mb-2">
                                –†–µ–π—Ç–∏–Ω–≥ —Å—Ç—Ä–∞–≤–∏ –º–æ–∂–Ω–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏—Ç–∏ –º—ñ–∂:
                            </p>
                            <ul class="text-gray-700 ml-4 space-y-1">
                                <li>‚Ä¢ ‚ù§Ô∏è –õ—ñ–∫—É–≤–∞–Ω–Ω—è —Ä–∞–Ω</li>
                                <li>‚Ä¢ üò∞ –ó–Ω—è—Ç—Ç—è —Å—Ç—Ä–µ—Å—É</li>
                                <li>‚Ä¢ ‚ú® –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–¥—ñ—ó</li>
                            </ul>
                            <p class="text-gray-700 mt-2 text-sm">
                                <strong>–ü—Ä–∏–∫–ª–∞–¥:</strong> –†–µ–π—Ç–∏–Ω–≥ 11 = 6 —Ä–∞–Ω + 4 —Å—Ç—Ä–µ—Å + 1 –Ω–∞–¥—ñ—è
                            </p>
                        </div>
                    </div>

                    <!-- –ñ–µ—Ç–æ–Ω–∏ –¥–æ—Å–≤—ñ–¥—É -->
                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="text-lg font-semibold text-yellow-800 mb-2">ü™ô –ñ–µ—Ç–æ–Ω–∏ –¥–æ—Å–≤—ñ–¥—É</h3>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <p class="text-gray-700 mb-2">
                                –©–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≥—Ä—É–ø–∞ –≥–æ—Ç—É—î —Å—Ç—Ä–∞–≤—É, —Å–º–∞–∫–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å —è–∫–æ—ó –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ —Ä–∞–Ω—ñ—à–µ –∑–∞–ø–∏—Å–∞–Ω–∏–º —É –∫—É–ª—ñ–Ω–∞—Ä–Ω—ñ–π –∫–Ω–∏–∑—ñ —Ä–µ—Ü–µ–ø—Ç–æ–º, –≥—Ä–∞–≤—Ü—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∂–µ—Ç–æ–Ω—ñ–≤, —Ä—ñ–≤–Ω—É –ø–æ—Ç–æ—á–Ω–æ–º—É —Ä—ñ–≤–Ω—é –≥—Ä—É–ø–∏.
                            </p>
                            <p class="text-gray-700">
                                <strong>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</strong> –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏–±—Ä–∞—Ç–∏ –∫—É–±–∏–∫, –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –º–æ–∂–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ –æ–¥–∏–Ω –∂–µ—Ç–æ–Ω.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->
    <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
    <div id="characterModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold mb-4">‚ûï –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
            <div class="space-y-4">
                <input type="text" id="characterName" placeholder="–Ü–º'—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞..." class="w-full p-3 border border-gray-300 rounded-lg">
                <input type="number" id="characterAttribute" min="1" max="10" value="3" placeholder="–ù–∞–π–≤–∏—â–∏–π –∞—Ç—Ä–∏–±—É—Ç" class="w-full p-3 border border-gray-300 rounded-lg">
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="saveCharacter()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                    –î–æ–¥–∞—Ç–∏
                </button>
                <button onclick="closeCharacterModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ—Ü–µ–ø—Ç—É -->
    <div id="recipeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold mb-4">üìñ –î–æ–¥–∞—Ç–∏ –¥–æ –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏</h3>
            <div class="space-y-4">
                <input type="text" id="recipeName" placeholder="–ù–∞–∑–≤–∞ —Å—Ç—Ä–∞–≤–∏..." class="w-full p-3 border border-gray-300 rounded-lg">
                <textarea id="recipeDescription" placeholder="–û–ø–∏—Å —Ç–∞ –º–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è..." class="w-full p-3 border border-gray-300 rounded-lg h-20 resize-none"></textarea>
                <textarea id="recipeNotes" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏..." class="w-full p-3 border border-gray-300 rounded-lg h-16 resize-none"></textarea>
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="saveRecipe()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                    –ó–±–µ—Ä–µ–≥—Ç–∏
                </button>
                <button onclick="closeRecipeModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –í–∏–±—ñ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
    <div id="inventoryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">üì¶ –í–∏–±—Ä–∞—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è</h3>
            <div id="inventoryModalContent" class="space-y-2 mb-4">
                <!-- –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —Ç—É—Ç -->
            </div>
            <div class="flex space-x-3">
                <button onclick="addSelectedToMeal()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                    ‚úÖ –î–æ–¥–∞—Ç–∏ –æ–±—Ä–∞–Ω—ñ –¥–æ –ø–∏—Ä—É
                </button>
                <button onclick="closeInventoryModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
const diceTypes = {
    'sweet': { sides: 4, name: '–°–æ–ª–æ–¥–∫–∏–π', color: 'pink', emoji: 'üçØ' },
    'salty': { sides: 6, name: '–°–æ–ª–æ–Ω–∏–π', color: 'blue', emoji: 'üßÇ' },
    'bitter': { sides: 8, name: '–ì—ñ—Ä–∫–∏–π', color: 'green', emoji: 'üåø' },
    'sour': { sides: 10, name: '–ö–∏—Å–ª–∏–π', color: 'yellow', emoji: 'üçã' },
    'savory': { sides: 12, name: '–ü—Ä—è–Ω–∏–π', color: 'red', emoji: 'üå∂Ô∏è' },
    'weird': { sides: 20, name: '–î–∏–≤–∞–∫—É–≤–∞—Ç–∏–π', color: 'purple', emoji: 'üîÆ' }
};

// –¢–∞–±–ª–∏—Ü—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
const beastParts = [
    "–°—Ç–æ–ø–∞", "–ü–æ—Ä–æ—à–æ–∫", "–ù–æ–≥–∞", "–ß–µ—Ä–µ–≤–æ", "–ñ–∏—Ä", "–Ø–π—Ü—è", "–ö—ñ—Å—Ç–∫–æ–≤–∏–π –º–æ–∑–æ–∫", "–Ø–∑–∏–∫", "–ú–æ–∑–æ–∫", "–¢–æ–≤—Å—Ç–∏–π –∫—Ä–∞–π",
    "–û—Ä–≥–∞–Ω", "–®–∫—ñ—Ä–∞", "–Ø—î—á–∫–∞", "–û—á—ñ", "–°–ª–∏–∑", "–†—ñ–≥", "–ú'—è—Å–æ/—Ñ–∞—Ä—à", "–©—ñ—á–∫–∏", "–ö—Ä–∏–ª–∞", "–°–µ–∫—Ä–µ—Ç"
];

const flowerParts = [
    "–ö–≤—ñ—Ç–∫–∞", "–ö–æ—Ä—ñ–Ω–Ω—è", "–°—Ç–µ–±–ª–∞", "–õ–∏—Å—Ç—è", "–¶–∏–±—É–ª–∏–Ω–∏", "–ì–æ—Ä—ñ—Ö–∏", "–ù–∞—Å—ñ–Ω–Ω—è", "–ö–æ—Ä–∞", "–Ø–≥–æ–¥–∏", "–§—Ä—É–∫—Ç",
    "–°—ñ–∫", "–ü–∏–ª–æ–∫", "–ì—Ä–∏–±", "–ù–µ–∫—Ç–∞—Ä", "–°—Ç—Ä—É—á–∫–∏", "–¢—Ä–∞–≤–∏", "–í–æ–¥–æ—Ä–æ—Å—Ç—ñ", "–ú–æ—Ö", "–ö—Ä—É–ø–∞", "–®–∫—ñ—Ä–∫–∞"
];

const flavorByHope = ['sweet', 'sweet', 'salty', 'salty', 'bitter', 'bitter', 'sour', 'sour', 'savory', 'savory', 'weird', 'weird'];

const specialProperties = [
    "–í–∏–∫–ª—é—á–Ω–æ –Ω—ñ–∂–Ω–µ –Ω–∞ –¥–æ—Ç–∏–∫.", "–í—Å–µ —â–µ –±'—î—Ç—å—Å—è –≤ –∫–æ–Ω–≤—É–ª—å—Å—ñ—è—Ö —ñ –∑–≤–∏–≤–∞—î—Ç—å—Å—è.", "–ü—Ä–∏–∫–∏–¥–∞—î—Ç—å—Å—è —Ç–∏–º, —á–∏–º –Ω–µ —î.",
    "–í–æ–ª–æ–¥—ñ—î –ø—Ä–æ–Ω–∏–∑–ª–∏–≤–∏–º –∞—Ä–æ–º–∞—Ç–æ–º.", "–ü—Ä–∏–≤–µ—Ä—Ç–∞—î –ø–æ–≥–ª—è–¥ —Å–≤–æ—ó–º —è—Å–∫—Ä–∞–≤–∏–º –∫–æ–ª—å–æ—Ä–æ–º.", "–ü—Ä–æ–∑–æ—Ä–µ, –º–æ–≤ –∫—Ä–∏—à—Ç–∞–ª—å.",
    "–ú–∞—î –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∞–±–æ —Ö–∏–º–µ—Ä–Ω—É —Ñ–æ—Ä–º—É.", "–í—Å—ñ—è–Ω–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –ø–æ–∑–Ω–∞—á–∫–∞–º–∏.", 
    "–°—Ç–∏—Å–∫–∞—î—Ç—å—Å—è —ñ –≤—ñ–¥–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –≤—ñ–¥ —Å–≤—ñ—Ç–ª–∞.", "–í—Ç—Ä–∞—á–∞—î —Å–≤–æ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≤ —Ç–µ–º—Ä—è–≤—ñ.",
    "–í–∏–ø—Ä–æ–º—ñ–Ω—é—î –Ω–µ–π–º–æ–≤—ñ—Ä–Ω–æ –∞–ø–µ—Ç–∏—Ç–Ω–∏–π –∞—Ä–æ–º–∞—Ç.", "–í–æ–ª–æ–¥—ñ—î –∑–æ–≤—Å—ñ–º –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–æ—é —Ç–µ–∫—Å—Ç—É—Ä–æ—é.",
    "–ù—ñ–±–∏ –≤ –∫–æ–∫–æ–Ω—ñ, —É–∫–ª–∞–¥–µ–Ω–µ –≤ —â—ñ–ª—å–Ω—É –æ–±–æ–ª–æ–Ω–∫—É.", "–ù–∞–ø–æ–≤–Ω–µ–Ω–µ —è–∫–æ—é—Å—å –∑–∞–≥–∞–¥–∫–æ–≤–æ—é —Å—É–±—Å—Ç–∞–Ω—Ü—ñ—î—é.",
    "–í–∏–ø—Ä–æ–º—ñ–Ω—é—î —Ö–º–∞—Ä–∫—É —Ä—ñ–∑–Ω–æ–∫–æ–ª—å–æ—Ä–æ–≤–æ–≥–æ –≥–∞–∑—É.", "–†–æ–∑–¥—ñ–ª—è—î—Ç—å—Å—è –Ω–∞ —Ç–æ–Ω–∫—ñ, –Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä—ñ —à–∞—Ä–∏.",
    "–ü–æ—Ç—Ä–µ–±—É—î –æ—Å–æ–±–ª–∏–≤–æ–≥–æ, –¥–∏–≤–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±—É –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è.", "–ù–∞–≥–∞–¥—É—î —à–∫—ñ—Ä—É –∞–±–æ —Ö—Ä—è—â –Ω–∞ –¥–æ—Ç–∏–∫.",
    "–õ–∞–º–∞—î—Ç—å—Å—è –≤—ñ–¥ –Ω–∞–π–º–µ–Ω—à–æ–≥–æ –¥–æ—Ç–∏–∫—É.", "–°—Ç–∞—î —Å–º–µ—Ä—Ç–µ–ª—å–Ω–æ—é –æ—Ç—Ä—É—Ç–æ—é –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏."
];

// –°—Ç–∞–Ω –¥–æ–¥–∞—Ç–∫–∞
let gameState = {
    rollCount: parseInt(localStorage.getItem('beastFeastRollCount') || '0'),
    successCount: parseInt(localStorage.getItem('beastFeastSuccessCount') || '0'),
    totalRating: parseInt(localStorage.getItem('beastFeastTotalRating') || '0'),
    groupLevel: parseInt(localStorage.getItem('beastFeastGroupLevel') || '1'),
    characters: JSON.parse(localStorage.getItem('beastFeastCharacters') || '[]'),
    inventory: JSON.parse(localStorage.getItem('beastFeastInventory') || '[]'),
    cookbook: JSON.parse(localStorage.getItem('beastFeastCookbook') || '[]'),
    currentDice: [],
    matchedValues: [],
    currentMealRating: 0,
    selectedIngredients: { group: [], characters: {} }
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
document.addEventListener('DOMContentLoaded', function() {
    updateStats();
    updateGroupLevelDisplay();
    loadCharacters();
    loadInventory();
    loadCookbook();
    updatePrediction();
    setupEventListeners();
});

// –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≤–∫–ª–∞–¥–∫–∞–º–∏
function switchTab(tabName) {
    // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –ó–Ω—è—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω –∑ –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-amber-500', 'text-amber-600');
        button.classList.add('border-transparent', 'text-gray-600');
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç–∏ –æ–±—Ä–∞–Ω—É –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName).classList.add('active');
    
    // –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É
    event.target.classList.remove('border-transparent', 'text-gray-600');
    event.target.classList.add('border-amber-500', 'text-amber-600');
}

// –§—É–Ω–∫—Ü—ñ—ó —Ä—ñ–≤–Ω—è –≥—Ä—É–ø–∏
function adjustGroupLevel(delta) {
    gameState.groupLevel = Math.max(1, Math.min(20, gameState.groupLevel + delta));
    updateGroupLevelDisplay();
    saveGameState();
}

function updateGroupLevelDisplay() {
    document.getElementById('groupLevel').textContent = gameState.groupLevel;
}

// –§—É–Ω–∫—Ü—ñ—ó —ñ–Ω–ø—É—Ç—ñ–≤ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
function adjustInput(flavor, delta) {
    const input = document.getElementById(flavor);
    const newValue = Math.max(0, Math.min(50, parseInt(input.value) + delta));
    input.value = newValue;
    updatePrediction();
}

function clearCookingInputs() {
    Object.keys(diceTypes).forEach(flavor => {
        document.getElementById(flavor).value = 0;
    });
    document.getElementById('token').value = 0;
    updatePrediction();
}

function updatePrediction() {
    const prediction = document.getElementById('prediction');
    const totalDice = Object.keys(diceTypes).reduce((sum, flavor) => {
        return sum + (parseInt(document.getElementById(flavor).value) || 0);
    }, 0);
    
    if (totalDice === 0) {
        prediction.classList.add('hidden');
        return;
    }
    
    const token = parseInt(document.getElementById('token').value) || 0;
    let message = `üé≤ ${totalDice} –∫—É–±–∏–∫—ñ–≤ —Å–º–∞–∫—É`;
    
    if (token > 0) {
        message += ` + ü™ô ${token} –∂–µ—Ç–æ–Ω—ñ–≤ –¥–æ—Å–≤—ñ–¥—É`;
    }
    
    if (totalDice >= 8) {
        message += `. –î—É–∂–µ –≤–∏—Å–æ–∫–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –∑–±—ñ–≥—ñ–≤! üéØ`;
    } else if (totalDice >= 5) {
        message += `. –í–∏—Å–æ–∫–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –∑–±—ñ–≥—ñ–≤ ü§û`;
    } else if (totalDice >= 3) {
        message += `. –ü–æ–º—ñ—Ä–Ω–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –∑–±—ñ–≥—ñ–≤ üòê`;
    } else {
        message += `. –ù–∏–∑—å–∫–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –∑–±—ñ–≥—ñ–≤ üòÖ`;
    }
    
    prediction.querySelector('p').textContent = message;
    prediction.classList.remove('hidden');
}

// –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è
function loadFromInventory() {
    const totalIngredients = gameState.inventory.length + 
        gameState.characters.reduce((sum, char) => sum + char.inventory.length, 0);
    
    if (totalIngredients === 0) {
        showNotification('–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π!', 'warning');
        return;
    }
    
    const modalContent = document.getElementById('inventoryModalContent');
    let html = '';
    
    // –ì—Ä—É–ø–æ–≤–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä
    if (gameState.inventory.length > 0) {
        html += '<h4 class="font-semibold text-gray-800 mb-2">üì¶ –ì—Ä—É–ø–æ–≤–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä</h4>';
        html += gameState.inventory.map((ingredient, index) => {
            const flavorText = Object.entries(ingredient.flavors)
                .map(([flavor, intensity]) => `${diceTypes[flavor].emoji} ${diceTypes[flavor].name}(${intensity})`)
                .join(', ');
            
            const typeIcon = ingredient.type === 'beast' ? 'üêª' : ingredient.type === 'flower' ? 'üå∏' : '‚≠ê';
            
            return `
                <div class="flex items-center p-3 bg-gray-50 rounded-lg border mb-2">
                    <input type="checkbox" id="group-ingredient-${index}" class="mr-3" onchange="toggleGroupIngredientSelection(${index})">
                    <div class="flex-1">
                        <label for="group-ingredient-${index}" class="cursor-pointer">
                            <span class="font-medium">${typeIcon} ${ingredient.part}</span>
                            <span class="ml-2 text-sm text-gray-600">${flavorText}</span>
                            ${ingredient.property ? `<div class="text-xs text-purple-600 italic">${ingredient.property}</div>` : ''}
                        </label>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    // –Ü–Ω–≤–µ–Ω—Ç–∞—Ä—ñ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
    gameState.characters.forEach(character => {
        if (character.inventory.length > 0) {
            html += `<h4 class="font-semibold text-blue-800 mb-2 mt-4">üë§ ${character.name}</h4>`;
            html += character.inventory.map((ingredient, index) => {
                const flavorText = Object.entries(ingredient.flavors)
                    .map(([flavor, intensity]) => `${diceTypes[flavor].emoji} ${diceTypes[flavor].name}(${intensity})`)
                    .join(', ');
                
                const typeIcon = ingredient.type === 'beast' ? 'üêª' : ingredient.type === 'flower' ? 'üå∏' : '‚≠ê';
                
                return `
                    <div class="flex items-center p-3 bg-blue-50 rounded-lg border mb-2">
                        <input type="checkbox" id="char-${character.id}-ingredient-${index}" class="mr-3" onchange="toggleCharacterIngredientSelection(${character.id}, ${index})">
                        <div class="flex-1">
                            <label for="char-${character.id}-ingredient-${index}" class="cursor-pointer">
                                <span class="font-medium">${typeIcon} ${ingredient.part}</span>
                                <span class="ml-2 text-sm text-gray-600">${flavorText}</span>
                                ${ingredient.property ? `<div class="text-xs text-purple-600 italic">${ingredient.property}</div>` : ''}
                            </label>
                        </div>
                    </div>
                `;
            }).join('');
        }
    });
    
    modalContent.innerHTML = html;
    gameState.selectedIngredients = { group: [], characters: {} };
    document.getElementById('inventoryModal').classList.remove('hidden');
}

function toggleGroupIngredientSelection(index) {
    const checkbox = document.getElementById(`group-ingredient-${index}`);
    if (checkbox.checked) {
        gameState.selectedIngredients.group.push(index);
    } else {
        gameState.selectedIngredients.group = gameState.selectedIngredients.group.filter(i => i !== index);
    }
}

function toggleCharacterIngredientSelection(characterId, index) {
    const checkbox = document.getElementById(`char-${characterId}-ingredient-${index}`);
    if (!gameState.selectedIngredients.characters[characterId]) {
        gameState.selectedIngredients.characters[characterId] = [];
    }
    
    if (checkbox.checked) {
        gameState.selectedIngredients.characters[characterId].push(index);
    } else {
        gameState.selectedIngredients.characters[characterId] = 
            gameState.selectedIngredients.characters[characterId].filter(i => i !== index);
    }
}

function addSelectedToMeal() {
    const totalSelected = gameState.selectedIngredients.group.length + 
        Object.values(gameState.selectedIngredients.characters).reduce((sum, arr) => sum + arr.length, 0);
    
    if (totalSelected === 0) {
        showNotification('–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç!', 'warning');
        return;
    }
    
    let addedCount = 0;
    
    // –î–æ–¥–∞—î–º–æ –≥—Ä—É–ø–æ–≤—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏
    gameState.selectedIngredients.group.forEach(index => {
        const ingredient = gameState.inventory[index];
        Object.entries(ingredient.flavors).forEach(([flavor, intensity]) => {
            const current = parseInt(document.getElementById(flavor).value) || 0;
            document.getElementById(flavor).value = current + intensity;
        });
        addedCount++;
    });
    
    // –î–æ–¥–∞—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
    Object.entries(gameState.selectedIngredients.characters).forEach(([characterId, indices]) => {
        const character = gameState.characters.find(c => c.id == characterId);
        if (character) {
            indices.forEach(index => {
                const ingredient = character.inventory[index];
                Object.entries(ingredient.flavors).forEach(([flavor, intensity]) => {
                    const current = parseInt(document.getElementById(flavor).value) || 0;
                    document.getElementById(flavor).value = current + intensity;
                });
                addedCount++;
            });
        }
    });
    
    // –í–∏–¥–∞–ª—è—î–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ (–≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É)
    gameState.selectedIngredients.group.sort((a, b) => b - a).forEach(index => {
        gameState.inventory.splice(index, 1);
    });
    
    Object.entries(gameState.selectedIngredients.characters).forEach(([characterId, indices]) => {
        const character = gameState.characters.find(c => c.id == characterId);
        if (character) {
            indices.sort((a, b) => b - a).forEach(index => {
                character.inventory.splice(index, 1);
            });
        }
    });
    
    updateInventoryDisplay();
    loadCharacters();
    updatePrediction();
    saveGameState();
    closeInventoryModal();
    switchTab('cooking');
    
    showNotification(`–î–æ–¥–∞–Ω–æ ${addedCount} —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –¥–æ –ø–∏—Ä—É`, 'success');
}

function closeInventoryModal() {
    document.getElementById('inventoryModal').classList.add('hidden');
    gameState.selectedIngredients = { group: [], characters: {} };
}

// –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è
function startCooking() {
    const dicePool = [];
    let idx = 0;
    
    // –ó–±–∏—Ä–∞—î–º–æ –∫—É–±–∏–∫–∏
    for (const [flavor, info] of Object.entries(diceTypes)) {
        const num = parseInt(document.getElementById(flavor).value) || 0;
        for (let i = 0; i < num; i++) {
            dicePool.push({
                flavor: flavor,
                sides: info.sides,
                idx: idx++,
                value: null
            });
        }
    }

    if (dicePool.length === 0) {
        showNotification('–î–æ–¥–∞–π—Ç–µ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –¥–ª—è –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è!', 'warning');
        return;
    }

    // –ö–∏–¥–∞—î–º–æ –∫—É–±–∏–∫–∏
    rollDicePool(dicePool);
    gameState.currentDice = dicePool;
    gameState.matchedValues = [];
    gameState.rollCount++;
    
    updateStats();
    
    // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
    const resultsSection = document.getElementById('cookingResults');
    resultsSection.classList.remove('hidden');
    resultsSection.scrollIntoView({ behavior: 'smooth' });
    
    const output = document.getElementById('cookingOutput');
    output.innerHTML = '<h4 class="text-lg font-semibold text-gray-800 mb-3">üé≤ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∫–∏–¥–∞–Ω–Ω—è –∫—É–±–∏–∫—ñ–≤:</h4>';
    
    displayDice(gameState.currentDice);
    proceedCookingLogic();
}

function rollDicePool(dicePool) {
    dicePool.forEach(die => {
        die.value = Math.floor(Math.random() * die.sides) + 1;
    });
    return dicePool;
}

function displayDice(dicePool) {
    const container = document.getElementById('cookingOutput');
    
    if (dicePool.length === 0) {
        container.innerHTML += '<p class="text-gray-600">–ö—É–±–∏–∫—ñ–≤ –Ω–µ –∑–∞–ª–∏—à–∏–ª–æ—Å—å.</p>';
        return;
    }

    const grouped = {};
    dicePool.forEach(die => {
        if (!grouped[die.flavor]) {
            grouped[die.flavor] = [];
        }
        grouped[die.flavor].push(die.value);
    });

    let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
    for (const [flavor, rolls] of Object.entries(grouped)) {
        const flavorInfo = diceTypes[flavor];
        html += `
            <div class="p-4 rounded-lg border-2 bg-${flavorInfo.color}-50 border-${flavorInfo.color}-300">
                <div class="flex items-center space-x-2 mb-2">
                    <span class="text-2xl">${flavorInfo.emoji}</span>
                    <span class="font-medium text-${flavorInfo.color}-800">${flavorInfo.name} (–∫${flavorInfo.sides})</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    ${rolls.map(roll => `
                        <div class="w-10 h-10 bg-${flavorInfo.color}-200 border-2 border-${flavorInfo.color}-400 rounded-lg flex items-center justify-center font-bold text-${flavorInfo.color}-800">
                            ${roll}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    html += '</div>';
    
    container.innerHTML += html;
}

function findDuplicates(dicePool) {
    const values = dicePool.map(die => die.value);
    const valueCounts = {};
    values.forEach(value => {
        valueCounts[value] = (valueCounts[value] || 0) + 1;
    });
    
    const duplicates = {};
    for (const [value, count] of Object.entries(valueCounts)) {
        if (count > 1) {
            duplicates[parseInt(value)] = count;
        }
    }
    return duplicates;
}

function diceWithoutValues(dicePool, values) {
    const valueSet = new Set(values);
    return dicePool.filter(die => !valueSet.has(die.value));
}

function proceedCookingLogic() {
    const output = document.getElementById('cookingOutput');
    const duplicates = findDuplicates(gameState.currentDice);
    
    if (gameState.currentDice.length === 1) {
        const die = gameState.currentDice[0];
        const flavorInfo = diceTypes[die.flavor];
        output.innerHTML += `
            <div class="mt-4 p-4 bg-green-100 border border-green-300 rounded-lg">
                <p class="text-green-800 font-semibold">
                    ‚úÖ –û—Å—Ç–∞–Ω–Ω—ñ–π —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç: ${flavorInfo.emoji} ${flavorInfo.name} (–∫${die.sides}) = ${die.value}
                </p>
                <p class="text-green-700 mt-2">–ü–∏—Ä –≥–æ—Ç–æ–≤–∏–π! üçΩÔ∏è</p>
            </div>
        `;
        
        finishCooking();
        return;
    }

    if (Object.keys(duplicates).length === 0) {
        output.innerHTML += `
            <div class="mt-4 p-4 bg-yellow-100 border border-yellow-300 rounded-lg">
                <p class="text-yellow-800">‚ö†Ô∏è –°–º–∞–∫–∏ –Ω–µ –∑–º—ñ—à–∞–ª–∏—Å—å. –í–∏–±–µ—Ä—ñ—Ç—å —â–æ –ø—Ä–∏–±—Ä–∞—Ç–∏:</p>
            </div>
        `;
        showRemoveOptions();
    } else {
        output.innerHTML += '<div class="mt-4 p-4 bg-blue-100 border border-blue-300 rounded-lg">';
        output.innerHTML += '<p class="text-blue-800 font-semibold mb-2">üéØ –°–º–∞–∫–∏ –∑–ª–∏–ª–∏—Å—å —É—Å–ø—ñ—à–Ω–æ:</p>';
        
        for (const [value, count] of Object.entries(duplicates)) {
            const flavors = gameState.currentDice
                .filter(die => die.value === parseInt(value))
                .map(die => diceTypes[die.flavor].name);
            const uniqueFlavors = [...new Set(flavors)];
            
            output.innerHTML += `<p class="text-blue-700">‚Ä¢ –ó–Ω–∞—á–µ–Ω–Ω—è ${value} (${count} —Ä–∞–∑—ñ–≤): ${uniqueFlavors.join(', ')}</p>`;
        }
        output.innerHTML += '</div>';

        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–±—ñ–≥–∏
        for (const value of Object.keys(duplicates)) {
            const numValue = parseInt(value);
            if (!gameState.matchedValues.includes(numValue)) {
                gameState.matchedValues.push(numValue);
            }
        }

        // –í–∏–¥–∞–ª—è—î–º–æ –∫—É–±–∏–∫–∏ –∑—ñ –∑–±—ñ–≥–∞–º–∏
        const matchedSet = Object.keys(duplicates).map(v => parseInt(v));
        const remaining = diceWithoutValues(gameState.currentDice, matchedSet);
        
        if (remaining.length === 0) {
            output.innerHTML += `
                <div class="mt-4 p-4 bg-green-100 border border-green-300 rounded-lg">
                    <p class="text-green-800 font-semibold">üéâ –í—Å—ñ —Å–º–∞–∫–∏ —ñ–¥–µ–∞–ª—å–Ω–æ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω—ñ!</p>
                </div>
            `;
            finishCooking();
            return;
        }

        output.innerHTML += `
            <div class="mt-4 p-4 bg-gray-100 border border-gray-300 rounded-lg">
                <p class="text-gray-800">üîÑ ${remaining.length} —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è.</p>
            </div>
        `;
        
        showRerollButton(remaining);
    }
}

function showRemoveOptions() {
    const output = document.getElementById('cookingOutput');
    
    let options = '<select id="removeSelect" class="w-full p-2 border border-gray-300 rounded-md mb-3">';
    
    gameState.currentDice.forEach(die => {
        const flavorInfo = diceTypes[die.flavor];
        options += `<option value="die-${die.idx}">${flavorInfo.emoji} ${flavorInfo.name} (–∫${die.sides}) ‚Üí ${die.value}</option>`;
    });
    
    const tokenValue = parseInt(document.getElementById('token').value) || 0;
    if (tokenValue > 0) {
        options += `<option value="token">ü™ô –ñ–µ—Ç–æ–Ω –¥–æ—Å–≤—ñ–¥—É (${tokenValue})</option>`;
    }
    
    options += '</select>';
    
    output.innerHTML += `
        <div class="mt-4 p-4 bg-white border border-gray-300 rounded-lg">
            <p class="text-gray-800 mb-3">–í–∏–±–µ—Ä—ñ—Ç—å —â–æ –ø—Ä–∏–±—Ä–∞—Ç–∏ –∑ –ø–∏—Ä—É:</p>
            ${options}
            <button onclick="removeAndReroll()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                üóëÔ∏è –ü—Ä–∏–±—Ä–∞—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏
            </button>
        </div>
    `;
}

function removeAndReroll() {
    const select = document.getElementById('removeSelect');
    const value = select.value;
    
    if (value.startsWith('die-')) {
        const idx = parseInt(value.split('-')[1]);
        gameState.currentDice = gameState.currentDice.filter(die => die.idx !== idx);
    } else if (value === 'token') {
        const tokenInput = document.getElementById('token');
        tokenInput.value = Math.max(0, parseInt(tokenInput.value) - 1);
    }
    
    rollDicePool(gameState.currentDice);
    
    const output = document.getElementById('cookingOutput');
    output.innerHTML = '<h4 class="text-lg font-semibold text-gray-800 mb-3">üîÑ –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –≥–æ—Ç—É–≤–∞–Ω–Ω—è:</h4>';
    displayDice(gameState.currentDice);
    proceedCookingLogic();
}

function showRerollButton(remaining) {
    const output = document.getElementById('cookingOutput');
    
    output.innerHTML += `
        <div class="mt-4">
            <button onclick="rerollRemaining(${JSON.stringify(remaining).replace(/"/g, '&quot;')})" 
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                üé≤ –ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏ —Ä–µ—à—Ç—É —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
            </button>
        </div>
    `;
}

function rerollRemaining(remaining) {
    gameState.currentDice = remaining;
    rollDicePool(gameState.currentDice);
    
    const output = document.getElementById('cookingOutput');
    output.innerHTML = '<h4 class="text-lg font-semibold text-gray-800 mb-3">üîÑ –ü–µ—Ä–µ–º—ñ—à—É—î–º–æ —Ä–µ—à—Ç—É:</h4>';
    displayDice(gameState.currentDice);
    proceedCookingLogic();
}

function finishCooking() {
    if (gameState.matchedValues.length > 0) {
        const rating = calculateMealRating();
        gameState.currentMealRating = rating;
        showMealRating(rating);
        gameState.successCount++;
        gameState.totalRating += rating;
        updateStats();
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –∑–Ω–∞–π–æ–º–∏–π —Ä–µ—Ü–µ–ø—Ç
        checkForKnownRecipe();
        
        // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–π—Ç–∏–Ω–≥—É
        showMealDistribution(rating);
    }
    
    showCookingButtons();
}

function calculateMealRating() {
    const uniqueValues = [...new Set(gameState.matchedValues)];
    return uniqueValues.reduce((sum, val) => sum + val, 0);
}

function showMealRating(rating) {
    const output = document.getElementById('cookingOutput');
    const uniqueValues = [...new Set(gameState.matchedValues)].sort((a, b) => a - b);
    const detail = uniqueValues.join(' + ');
    
    let qualityClass = 'bg-gray-100 border-gray-300 text-gray-800';
    let qualityText = '–ü—Ä–æ–≤–∞–ª';
    let qualityEmoji = 'üòû';
    
    if (rating >= 20) {
        qualityClass = 'bg-purple-100 border-purple-300 text-purple-800';
        qualityText = '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π –ø–∏—Ä!';
        qualityEmoji = 'üèÜ';
    } else if (rating >= 15) {
        qualityClass = 'bg-orange-100 border-orange-300 text-orange-800';
        qualityText = '–í—ñ–¥–º—ñ–Ω–Ω–∏–π –ø–∏—Ä!';
        qualityEmoji = '‚≠ê';
    } else if (rating >= 10) {
        qualityClass = 'bg-green-100 border-green-300 text-green-800';
        qualityText = '–•–æ—Ä–æ—à–∏–π –ø–∏—Ä!';
        qualityEmoji = 'üëç';
    } else if (rating >= 5) {
        qualityClass = 'bg-yellow-100 border-yellow-300 text-yellow-800';
        qualityText = '–ó–≤–∏—á–∞–π–Ω–∏–π –ø–∏—Ä';
        qualityEmoji = 'üçΩÔ∏è';
    }
    
    output.innerHTML += `
        <div class="mt-4 p-6 ${qualityClass} border-2 rounded-lg">
            <div class="text-center">
                <div class="text-4xl mb-2">${qualityEmoji}</div>
                <p class="font-bold text-xl mb-2">
                    –†–µ–π—Ç–∏–Ω–≥ –ø–∏—Ä—É: ${detail} = ${rating}
                </p>
                <p class="text-lg">
                    ${qualityText}
                </p>
            </div>
        </div>
    `;
}

function checkForKnownRecipe() {
    const currentIngredients = getCurrentIngredientProfile();
    const knownRecipe = gameState.cookbook.find(recipe => 
        JSON.stringify(recipe.ingredients) === JSON.stringify(currentIngredients)
    );
    
    if (knownRecipe) {
        const tokensEarned = gameState.groupLevel;
        const currentTokens = parseInt(document.getElementById('token').value) || 0;
        document.getElementById('token').value = currentTokens + tokensEarned;
        
        showNotification(`–ó–Ω–∞–π–æ–º–∏–π —Ä–µ—Ü–µ–ø—Ç! –û—Ç—Ä–∏–º–∞–Ω–æ ${tokensEarned} –∂–µ—Ç–æ–Ω—ñ–≤ –¥–æ—Å–≤—ñ–¥—É`, 'success');
    }
}

function getCurrentIngredientProfile() {
    const ingredients = {};
    Object.keys(diceTypes).forEach(flavor => {
        const value = parseInt(document.getElementById(flavor).value) || 0;
        if (value > 0) ingredients[flavor] = value;
    });
    return ingredients;
}

function showMealDistribution(rating) {
    const distributionDiv = document.getElementById('mealDistribution');
    document.getElementById('totalMealRating').value = rating;
    document.getElementById('availablePoints').textContent = rating;
    distributionDiv.classList.remove('hidden');
    updateDistribution();
}

function updateDistribution() {
    const total = parseInt(document.getElementById('totalMealRating').value) || 0;
    const healing = parseInt(document.getElementById('healingPoints').value) || 0;
    const stress = parseInt(document.getElementById('stressRelief').value) || 0;
    const hope = parseInt(document.getElementById('hopeGain').value) || 0;
    const used = healing + stress + hope;
    
    document.getElementById('usedPoints').textContent = used;
    
    // –û–±–º–µ–∂—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
    if (used > total) {
        if (event && event.target) {
            if (event.target.id === 'healingPoints') {
                document.getElementById('healingPoints').value = Math.max(0, total - stress - hope);
            } else if (event.target.id === 'stressRelief') {
                document.getElementById('stressRelief').value = Math.max(0, total - healing - hope);
            } else if (event.target.id === 'hopeGain') {
                document.getElementById('hopeGain').value = Math.max(0, total - healing - stress);
            }
            updateDistribution();
        }
    }
}

function saveMealDistribution() {
    const healing = parseInt(document.getElementById('healingPoints').value) || 0;
    const stress = parseInt(document.getElementById('stressRelief').value) || 0;
    const hope = parseInt(document.getElementById('hopeGain').value) || 0;
    
    showNotification(`–†–æ–∑–ø–æ–¥—ñ–ª –∑–±–µ—Ä–µ–∂–µ–Ω–æ: ‚ù§Ô∏è${healing} üò∞${stress} ‚ú®${hope}`, 'success');
    
    // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –∫—É–ª—ñ–Ω–∞—Ä–Ω—É –∫–Ω–∏–≥—É
    document.getElementById('recipeModal').classList.remove('hidden');
}

function showCookingButtons() {
    const output = document.getElementById('cookingOutput');
    
    output.innerHTML += `
        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-3">
            <button onclick="resetCooking()" 
                    class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                üçΩÔ∏è –ü—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π –ø–∏—Ä
            </button>
            <button onclick="openRecipeModal()" 
                    class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                üìñ –î–æ–¥–∞—Ç–∏ –¥–æ –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏
            </button>
        </div>
    `;
}

function resetCooking() {
    clearCookingInputs();
    document.getElementById('cookingResults').classList.add('hidden');
    document.getElementById('mealDistribution').classList.add('hidden');
    gameState.currentDice = [];
    gameState.matchedValues = [];
    gameState.currentMealRating = 0;
    
    // –û—á–∏—â–∞—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª
    document.getElementById('healingPoints').value = 0;
    document.getElementById('stressRelief').value = 0;
    document.getElementById('hopeGain').value = 0;
    
    showNotification('–ì–æ—Ç–æ–≤—ñ –¥–æ –Ω–æ–≤–∏—Ö –∫—É–ª—ñ–Ω–∞—Ä–Ω–∏—Ö –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤! üç≥', 'success');
}

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
function generateBeastIngredients() {
    const wounds = parseInt(document.getElementById('beastWounds').value) || 4;
    let ingredientCount = 1;
    
    if (wounds >= 12) ingredientCount = 4;
    else if (wounds >= 8) ingredientCount = 3;
    else if (wounds >= 5) ingredientCount = 2;
    
    document.getElementById('beastIngredientCount').textContent = `–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤: ${ingredientCount}`;
    
    const results = [];
    for (let i = 0; i < ingredientCount; i++) {
        const part = beastParts[Math.floor(Math.random() * beastParts.length)];
        const flavors = generateRandomFlavors(wounds >= 8 ? 'strong' : 'weak');
        const property = Math.random() < 0.3 ? specialProperties[Math.floor(Math.random() * specialProperties.length)] : null;
        
        results.push({ 
            part, 
            flavors, 
            property, 
            type: 'beast',
            id: Date.now() + i 
        });
    }
    
    displayGeneratedIngredients('beastIngredientsResult', results);
}

function generateFlowerIngredient() {
    const hopeRoll = Math.floor(Math.random() * 12);
    const flavorType = flavorByHope[hopeRoll];
    const part = flowerParts[Math.floor(Math.random() * flowerParts.length)];
    const intensity = Math.floor(Math.random() * 3) + 1;
    const property = Math.random() < 0.2 ? specialProperties[Math.floor(Math.random() * specialProperties.length)] : null;
    
    const flavors = { [flavorType]: intensity };
    const ingredient = { 
        part, 
        flavors, 
        property, 
        type: 'flower',
        id: Date.now()
    };
    
    displayGeneratedIngredients('flowerIngredientResult', [ingredient]);
}

function createCustomIngredient() {
    const name = document.getElementById('customIngredientName').value.trim();
    const type = document.getElementById('customIngredientType').value;
    const property = document.getElementById('customIngredientProperty').value.trim();
    
    if (!name) {
        showNotification('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞!', 'warning');
        return;
    }
    
    const flavors = {};
    ['sweet', 'salty', 'bitter', 'sour', 'savory', 'weird'].forEach(flavor => {
        const value = parseInt(document.getElementById(`custom${flavor.charAt(0).toUpperCase() + flavor.slice(1)}`).value) || 0;
        if (value > 0) flavors[flavor] = value;
    });
    
    if (Object.keys(flavors).length === 0) {
        showNotification('–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–∏–Ω —Å–º–∞–∫!', 'warning');
        return;
    }
    
    const ingredient = {
        part: name,
        flavors: flavors,
        property: property || null,
        type: type,
        id: Date.now()
    };
    
    gameState.inventory.push(ingredient);
    updateInventoryDisplay();
    saveGameState();
    
    // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
    document.getElementById('customIngredientName').value = '';
    document.getElementById('customIngredientProperty').value = '';
    ['sweet', 'salty', 'bitter', 'sour', 'savory', 'weird'].forEach(flavor => {
        document.getElementById(`custom${flavor.charAt(0).toUpperCase() + flavor.slice(1)}`).value = 0;
    });
    
    showNotification(`–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç "${name}" —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –¥–æ–¥–∞–Ω–æ –¥–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è!`, 'success');
}

function generateRandomFlavors(strength = 'normal') {
    const flavors = {};
    const flavorKeys = Object.keys(diceTypes);
    const numFlavors = Math.floor(Math.random() * 3) + 1;
    
    for (let i = 0; i < numFlavors; i++) {
        const flavor = flavorKeys[Math.floor(Math.random() * flavorKeys.length)];
        if (!flavors[flavor]) {
            let intensity;
            if (strength === 'strong') {
                intensity = Math.floor(Math.random() * 2) + 2; // 2-3
            } else if (strength === 'weak') {
                intensity = Math.floor(Math.random() * 2) + 1; // 1-2
            } else {
                intensity = Math.floor(Math.random() * 3) + 1; // 1-3
            }
            flavors[flavor] = intensity;
        }
    }
    
    return flavors;
}

function generateIngredientProperty() {
    const property = specialProperties[Math.floor(Math.random() * specialProperties.length)];
    document.getElementById('ingredientPropertyResult').innerHTML = `
        <div class="p-4 bg-purple-100 border border-purple-300 rounded-lg">
            <p class="text-purple-800">${property}</p>
        </div>
    `;
}

function displayGeneratedIngredients(containerId, ingredients) {
    const container = document.getElementById(containerId);
    
    container.innerHTML = ingredients.map(ingredient => {
        const flavorText = Object.entries(ingredient.flavors)
            .map(([flavor, intensity]) => `${diceTypes[flavor].emoji} ${diceTypes[flavor].name}(${intensity})`)
            .join(', ');
        
        const typeIcon = ingredient.type === 'beast' ? 'üêª' : ingredient.type === 'flower' ? 'üå∏' : '‚≠ê';
        
        return `
            <div class="p-3 bg-white border border-gray-300 rounded-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="font-semibold text-gray-800">${typeIcon} ${ingredient.part}</div>
                        <div class="text-sm text-gray-600">${flavorText}</div>
                        ${ingredient.property ? `<div class="text-xs text-purple-600 italic mt-1">${ingredient.property}</div>` : ''}
                    </div>
                    <div class="flex flex-col space-y-1 ml-2">
                        <button onclick="addIngredientToCooking(${JSON.stringify(ingredient).replace(/"/g, '&quot;')})" 
                                class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                            üç≥ –î–æ –ø–∏—Ä—É
                        </button>
                        <button onclick="addToGroupInventory(${JSON.stringify(ingredient).replace(/"/g, '&quot;')})" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">
                            üì¶ –î–æ –≥—Ä—É–ø–∏
                        </button>
                        <button onclick="showCharacterSelection(${JSON.stringify(ingredient).replace(/"/g, '&quot;')})" 
                                class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded text-xs">
                            üë§ –î–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function addIngredientToCooking(ingredient) {
    // –î–æ–¥–∞—î–º–æ –¥–æ —ñ–Ω–ø—É—Ç—ñ–≤ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è
    Object.entries(ingredient.flavors).forEach(([flavor, intensity]) => {
        const current = parseInt(document.getElementById(flavor).value) || 0;
        document.getElementById(flavor).value = current + intensity;
    });
    
    updatePrediction();
    switchTab('cooking');
    showNotification(`–î–æ–¥–∞–Ω–æ –¥–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è: ${ingredient.part}`, 'success');
}

function addToGroupInventory(ingredient) {
    gameState.inventory.push({
        ...ingredient,
        id: Date.now() + Math.random()
    });
    updateInventoryDisplay();
    saveGameState();
    showNotification(`${ingredient.part} –¥–æ–¥–∞–Ω–æ –¥–æ –≥—Ä—É–ø–æ–≤–æ–≥–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è!`, 'success');
}

function showCharacterSelection(ingredient) {
    if (gameState.characters.length === 0) {
        showNotification('–°–ø–æ—á–∞—Ç–∫—É –¥–æ–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤!', 'warning');
        return;
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ –∑ –≤—ñ–ª—å–Ω–∏–º –º—ñ—Å—Ü–µ–º
    const availableCharacters = gameState.characters.filter(char => 
        char.inventory.length < char.highestAttribute
    );
    
    if (availableCharacters.length === 0) {
        showNotification('–£ –≤—Å—ñ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä!', 'warning');
        return;
    }
    
    const modalContent = `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="characterSelectionModal">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">üë§ –û–±—Ä–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
                <div class="mb-4">
                    <div class="font-medium text-gray-800 mb-2">
                        ${ingredient.type === 'beast' ? 'üêª' : ingredient.type === 'flower' ? 'üå∏' : '‚≠ê'} ${ingredient.part}
                    </div>
                    <div class="text-sm text-gray-600">
                        ${Object.entries(ingredient.flavors).map(([flavor, intensity]) => 
                            `${diceTypes[flavor].emoji} ${diceTypes[flavor].name}(${intensity})`
                        ).join(', ')}
                    </div>
                </div>
                <div class="space-y-2 mb-4 max-h-48 overflow-y-auto">
                    ${availableCharacters.map(character => `
                        <button onclick="addToCharacterInventory(${character.id}, ${JSON.stringify(ingredient).replace(/"/g, '&quot;')})" 
                                class="w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium text-blue-800">${character.name}</div>
                                    <div class="text-sm text-blue-600">
                                        –Ü–Ω–≤–µ–Ω—Ç–∞—Ä: ${character.inventory.length} / ${character.highestAttribute}
                                    </div>
                                </div>
                                <div class="text-blue-500">
                                    ${character.highestAttribute - character.inventory.length} –≤—ñ–ª—å–Ω–æ
                                </div>
                            </div>
                        </button>
                    `).join('')}
                </div>
                <button onclick="closeCharacterSelection()" 
                        class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalContent);
}

function addToCharacterInventory(characterId, ingredient) {
    const character = gameState.characters.find(c => c.id === characterId);
    
    if (!character) {
        showNotification('–ü–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!', 'error');
        return;
    }
    
    if (character.inventory.length >= character.highestAttribute) {
        showNotification(`–£ ${character.name} –Ω–µ–º–∞—î –º—ñ—Å—Ü—è –≤ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—ñ!`, 'warning');
        return;
    }
    
    // –î–æ–¥–∞—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –¥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    character.inventory.push({
        ...ingredient,
        id: Date.now() + Math.random()
    });
    
    loadCharacters();
    saveGameState();
    closeCharacterSelection();
    
    showNotification(`${ingredient.part} –¥–æ–¥–∞–Ω–æ –¥–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è ${character.name}!`, 'success');
}

function closeCharacterSelection() {
    const modal = document.getElementById('characterSelectionModal');
    if (modal) {
        modal.remove();
    }
}

// –§—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
function addCharacter() {
    document.getElementById('characterModal').classList.remove('hidden');
    document.getElementById('characterName').focus();
}

function saveCharacter() {
    const name = document.getElementById('characterName').value.trim();
    const attribute = parseInt(document.getElementById('characterAttribute').value) || 3;
    
    if (!name) {
        showNotification('–í–≤–µ–¥—ñ—Ç—å —ñ–º\'—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!', 'warning');
        return;
    }
    
    const character = {
        id: Date.now(),
        name: name,
        highestAttribute: attribute,
        inventory: []
    };
    
    gameState.characters.push(character);
    loadCharacters();
    closeCharacterModal();
    saveGameState();
    showNotification(`–ü–µ—Ä—Å–æ–Ω–∞–∂ ${name} –¥–æ–¥–∞–Ω–æ!`, 'success');
}

function closeCharacterModal() {
    document.getElementById('characterModal').classList.add('hidden');
    document.getElementById('characterName').value = '';
    document.getElementById('characterAttribute').value = 3;
}

function loadCharacters() {
    const container = document.getElementById('charactersList');
    
    if (gameState.characters.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic col-span-full">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º</p>';
        return;
    }
    
    container.innerHTML = gameState.characters.map(character => `
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex justify-between items-start mb-2">
                <h4 class="font-semibold text-blue-800">${character.name}</h4>
                <button onclick="removeCharacter(${character.id})" class="text-red-500 hover:text-red-700 text-sm">
                    üóëÔ∏è
                </button>
            </div>
            <div class="text-sm text-blue-600 mb-2">
                –Ü–Ω–≤–µ–Ω—Ç–∞—Ä: ${character.inventory.length} / ${character.highestAttribute}
                ${character.inventory.length >= character.highestAttribute ? 
                    '<span class="text-red-600 ml-1">(–ü–æ–≤–Ω–∏–π)</span>' : 
                    `<span class="text-green-600 ml-1">(${character.highestAttribute - character.inventory.length} –≤—ñ–ª—å–Ω–æ)</span>`
                }
            </div>
            <div class="space-y-1">
                ${character.inventory.map((item, itemIndex) => `
                    <div class="text-xs bg-white p-2 rounded border flex justify-between items-center">
                        <div>
                            ${item.type === 'beast' ? 'üêª' : item.type === 'flower' ? 'üå∏' : '‚≠ê'} ${item.part}
                            - ${Object.entries(item.flavors).map(([f, i]) => `${diceTypes[f].emoji}${i}`).join(' ')}
                            ${item.property ? `<div class="text-purple-600 italic">${item.property}</div>` : ''}
                        </div>
                        <div class="flex space-x-1">
                            <button onclick="useCharacterIngredient(${character.id}, ${itemIndex})" 
                                    class="bg-green-500 hover:bg-green-600 text-white px-1 py-0.5 rounded text-xs">
                                üç≥
                            </button>
                            <button onclick="moveToGroupInventory(${character.id}, ${itemIndex})" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-1 py-0.5 rounded text-xs">
                                üì¶
                            </button>
                            <button onclick="removeCharacterItem(${character.id}, ${itemIndex})" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-1 py-0.5 rounded text-xs">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `).join('') || '<div class="text-xs text-gray-500 italic">–ü–æ—Ä–æ–∂–Ω—ñ–π —ñ–Ω–≤–µ–Ω—Ç–∞—Ä</div>'}
            </div>
            ${character.inventory.length > 0 ? `
                <div class="mt-2 pt-2 border-t border-blue-200">
                    <button onclick="useAllCharacterIngredients(${character.id})" 
                            class="w-full bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                        üç≥ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤—Å–µ –¥–ª—è –ø–∏—Ä—É
                    </button>
                </div>
            ` : ''}
        </div>
    `).join('');
}

function removeCharacter(id) {
    if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?')) {
        gameState.characters = gameState.characters.filter(c => c.id !== id);
        loadCharacters();
        saveGameState();
    }
}

function useCharacterIngredient(characterId, itemIndex) {
    const character = gameState.characters.find(c => c.id === characterId);
    if (!character || !character.inventory[itemIndex]) return;
    
    const ingredient = character.inventory[itemIndex];
    
    // –î–æ–¥–∞—î–º–æ –¥–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è
    Object.entries(ingredient.flavors).forEach(([flavor, intensity]) => {
        const current = parseInt(document.getElementById(flavor).value) || 0;
        document.getElementById(flavor).value = current + intensity;
    });
    
    // –í–∏–¥–∞–ª—è—î–º–æ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    character.inventory.splice(itemIndex, 1);
    
    loadCharacters();
    updatePrediction();
    saveGameState();
    switchTab('cooking');
    
    showNotification(`${ingredient.part} –≤—ñ–¥ ${character.name} –¥–æ–¥–∞–Ω–æ –¥–æ –ø–∏—Ä—É!`, 'success');
}

function moveToGroupInventory(characterId, itemIndex) {
    const character = gameState.characters.find(c => c.id === characterId);
    if (!character || !character.inventory[itemIndex]) return;
    
    const ingredient = character.inventory[itemIndex];
    
    // –ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ –¥–æ –≥—Ä—É–ø–æ–≤–æ–≥–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è
    gameState.inventory.push(ingredient);
    character.inventory.splice(itemIndex, 1);
    
    loadCharacters();
    updateInventoryDisplay();
    saveGameState();
    
    showNotification(`${ingredient.part} –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤—ñ–¥ ${character.name} –¥–æ –≥—Ä—É–ø–æ–≤–æ–≥–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è!`, 'success');
}

function removeCharacterItem(characterId, itemIndex) {
    const character = gameState.characters.find(c => c.id === characterId);
    if (!character || !character.inventory[itemIndex]) return;
    
    const ingredient = character.inventory[itemIndex];
    
    if (confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${ingredient.part} –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è ${character.name}?`)) {
        character.inventory.splice(itemIndex, 1);
        loadCharacters();
        saveGameState();
        showNotification(`${ingredient.part} –≤–∏–¥–∞–ª–µ–Ω–æ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è ${character.name}`, 'success');
    }
}

function useAllCharacterIngredients(characterId) {
    const character = gameState.characters.find(c => c.id === characterId);
    if (!character || character.inventory.length === 0) return;
    
    if (confirm(`–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤—Å—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ ${character.name} –¥–ª—è –ø–∏—Ä—É?`)) {
        character.inventory.forEach(ingredient => {
            Object.entries(ingredient.flavors).forEach(([flavor, intensity]) => {
                const current = parseInt(document.getElementById(flavor).value) || 0;
                document.getElementById(flavor).value = current + intensity;
            });
        });
        
        const count = character.inventory.length;
        character.inventory = [];
        
        loadCharacters();
        updatePrediction();
        saveGameState();
        switchTab('cooking');
        
        showNotification(`${count} —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –≤—ñ–¥ ${character.name} –¥–æ–¥–∞–Ω–æ –¥–æ –ø–∏—Ä—É!`, 'success');
    }
}

// –§—É–Ω–∫—Ü—ñ—ó —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è
function updateInventoryDisplay() {
    const container = document.getElementById('groupInventory');
    
    if (gameState.inventory.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑\'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç –ø—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</p>';
        return;
    }
    
    container.innerHTML = gameState.inventory.map((ingredient, index) => {
        const flavorText = Object.entries(ingredient.flavors)
            .map(([flavor, intensity]) => `${diceTypes[flavor].emoji}${intensity}`)
            .join(' ');
        
        const typeIcon = ingredient.type === 'beast' ? 'üêª' : ingredient.type === 'flower' ? 'üå∏' : '‚≠ê';
        
        return `
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border">
                <div>
                    <span class="font-medium">${typeIcon} ${ingredient.part}</span>
                    <span class="ml-2 text-sm text-gray-600">${flavorText}</span>
                    ${ingredient.property ? `<div class="text-xs text-purple-600 italic">${ingredient.property}</div>` : ''}
                </div>
                <div class="flex space-x-2">
                    <button onclick="addIngredientToCooking(${JSON.stringify(ingredient).replace(/"/g, '&quot;')})" 
                            class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">
                        üç≥ –î–æ –ø–∏—Ä—É
                    </button>
                    <button onclick="removeFromInventory(${index})" 
                            class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
        `;
    }).join('');
    
    updateStats();
}

function removeFromInventory(index) {
    gameState.inventory.splice(index, 1);
    updateInventoryDisplay();
    saveGameState();
}

function loadInventory() {
    updateInventoryDisplay();
}

function clearInventory() {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å —ñ–Ω–≤–µ–Ω—Ç–∞—Ä?')) {
        gameState.inventory = [];
        updateInventoryDisplay();
        saveGameState();
        showNotification('–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –æ—á–∏—â–µ–Ω–æ', 'success');
    }
}

// –§—É–Ω–∫—Ü—ñ—ó –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏
function loadQuickRecipe(type) {
    clearCookingInputs();
    
    switch(type) {
        case 'simple':
            document.getElementById('salty').value = 1;
            document.getElementById('savory').value = 2;
            break;
        case 'mushroom':
            document.getElementById('bitter').value = 1;
            document.getElementById('savory').value = 2;
            break;
        case 'wyvern':
            document.getElementById('sour').value = 1;
            document.getElementById('savory').value = 1;
            document.getElementById('weird').value = 1;
            break;
    }
    
    updatePrediction();
    switchTab('cooking');
    showNotification('–†–µ—Ü–µ–ø—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'success');
}

function openRecipeModal() {
    document.getElementById('recipeModal').classList.remove('hidden');
    document.getElementById('recipeName').focus();
}

function closeRecipeModal() {
    document.getElementById('recipeModal').classList.add('hidden');
    document.getElementById('recipeName').value = '';
    document.getElementById('recipeDescription').value = '';
    document.getElementById('recipeNotes').value = '';
}

function saveRecipe() {
    const name = document.getElementById('recipeName').value.trim();
    const description = document.getElementById('recipeDescription').value.trim();
    const notes = document.getElementById('recipeNotes').value.trim();
    
    if (!name) {
        showNotification('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–∏—Ä—É!', 'warning');
        return;
    }
    
    const ingredients = getCurrentIngredientProfile();
    const healing = parseInt(document.getElementById('healingPoints').value) || 0;
    const stress = parseInt(document.getElementById('stressRelief').value) || 0;
    const hope = parseInt(document.getElementById('hopeGain').value) || 0;
    
    const recipe = {
        id: Date.now(),
        name: name,
        description: description,
        notes: notes,
        ingredients: ingredients,
        rating: gameState.currentMealRating,
        distribution: { healing, stress, hope },
        matches: [...gameState.matchedValues],
        timestamp: new Date().toLocaleString('uk-UA')
    };
    
    gameState.cookbook.unshift(recipe);
    gameState.cookbook = gameState.cookbook.slice(0, 100);
    
    loadCookbook();
    closeRecipeModal();
    saveGameState();
    showNotification(`"${name}" –¥–æ–¥–∞–Ω–æ –¥–æ –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏!`, 'success');
}

function loadCookbook() {
    const container = document.getElementById('savedRecipes');
    
    if (gameState.cookbook.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic">–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ –∑\'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç</p>';
        return;
    }
    
    container.innerHTML = gameState.cookbook.map(recipe => {
        const ingredientText = Object.entries(recipe.ingredients)
            .map(([flavor, count]) => `${diceTypes[flavor].emoji}${count}`)
            .join(' ');
        
        let qualityClass = 'from-gray-50 to-gray-100 border-gray-300';
        if (recipe.rating >= 20) qualityClass = 'from-purple-50 to-purple-100 border-purple-300';
        else if (recipe.rating >= 15) qualityClass = 'from-orange-50 to-orange-100 border-orange-300';
        else if (recipe.rating >= 10) qualityClass = 'from-green-50 to-green-100 border-green-300';
        else if (recipe.rating >= 5) qualityClass = 'from-yellow-50 to-yellow-100 border-yellow-300';
        
        return `
            <div class="p-4 bg-gradient-to-r ${qualityClass} rounded-lg border">
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-semibold text-gray-800">${recipe.name}</h4>
                    <div class="flex space-x-2">
                        <button onclick="loadSavedRecipe(${recipe.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            üìã –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏
                        </button>
                        <button onclick="removeRecipe(${recipe.id})" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                
                <div class="text-sm text-gray-600 mb-2">
                    <strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${ingredientText}
                </div>
                
                ${recipe.description ? `<div class="text-sm text-gray-700 mb-2"><strong>–ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è:</strong> ${recipe.description}</div>` : ''}
                
                <div class="text-sm text-gray-600 mb-2">
                    <strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ${recipe.rating} 
                    (‚ù§Ô∏è${recipe.distribution.healing} üò∞${recipe.distribution.stress} ‚ú®${recipe.distribution.hope})
                </div>
                
                <div class="text-sm text-gray-600 mb-2">
                    <strong>–ó–±—ñ–≥–∏:</strong> [${recipe.matches.join(', ')}]
                </div>
                
                ${recipe.notes ? `<div class="text-xs text-gray-500 italic">${recipe.notes}</div>` : ''}
                
                <div class="text-xs text-gray-400 mt-2">${recipe.timestamp}</div>
            </div>
        `;
    }).join('');
}

function loadSavedRecipe(id) {
    const recipe = gameState.cookbook.find(r => r.id === id);
    if (!recipe) return;
    
    clearCookingInputs();
    
    Object.entries(recipe.ingredients).forEach(([flavor, count]) => {
        document.getElementById(flavor).value = count;
    });
    
    updatePrediction();
    switchTab('cooking');
    showNotification(`–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: ${recipe.name}`, 'success');
}

function removeRecipe(id) {
    if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ä–µ—Ü–µ–ø—Ç –∑ –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ—ó –∫–Ω–∏–≥–∏?')) {
        gameState.cookbook = gameState.cookbook.filter(r => r.id !== id);
        loadCookbook();
        saveGameState();
    }
}

function exportCookbook() {
    if (gameState.cookbook.length === 0) {
        showNotification('–ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞ –ø–æ—Ä–æ–∂–Ω—è!', 'warning');
        return;
    }
    
    const text = "üçñ –ö–£–õ–Ü–ù–ê–†–ù–ê –ö–ù–ò–ì–ê –ì–†–£–ü–ò - BEAST FEAST\n" +
        "=" + "=".repeat(60) + "\n\n" +
        `–†—ñ–≤–µ–Ω—å –≥—Ä—É–ø–∏: ${gameState.groupLevel}\n` +
        `–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ—Ü–µ–ø—Ç—ñ–≤: ${gameState.cookbook.length}\n` +
        `–°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥: ${(gameState.totalRating / gameState.successCount || 0).toFixed(1)}\n\n` +
        gameState.cookbook.map(recipe => 
            `üìñ ${recipe.name}\n` +
            `üóìÔ∏è –î–∞—Ç–∞: ${recipe.timestamp}\n` +
            `ü•Ñ –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏: ${Object.entries(recipe.ingredients).map(([flavor, count]) => 
                `${diceTypes[flavor].name}(${count})`
            ).join(', ')}\n` +
            `‚≠ê –†–µ–π—Ç–∏–Ω–≥ –ø–∏—Ä—É: ${recipe.rating}\n` +
            `üìä –†–æ–∑–ø–æ–¥—ñ–ª: –õ—ñ–∫—É–≤–∞–Ω–Ω—è(${recipe.distribution.healing}) –°—Ç—Ä–µ—Å(${recipe.distribution.stress}) –ù–∞–¥—ñ—è(${recipe.distribution.hope})\n` +
            `üé≤ –ó–±—ñ–≥–∏: [${recipe.matches.join(', ')}]\n` +
            `${recipe.description ? `üç≥ –ü—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è: ${recipe.description}\n` : ''}` +
            `${recipe.notes ? `üìù –ù–æ—Ç–∞—Ç–∫–∏: ${recipe.notes}\n` : ''}` +
            `${'-'.repeat(50)}\n\n`
        ).join('');
    
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `beast-feast-cookbook-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('–ö—É–ª—ñ–Ω–∞—Ä–Ω–∞ –∫–Ω–∏–≥–∞ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–∞!', 'success');
}

// –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
function updateStats() {
    document.getElementById('rollCount').textContent = gameState.rollCount;
    document.getElementById('successCount').textContent = gameState.successCount;
    document.getElementById('totalIngredients').textContent = gameState.inventory.length;
    
    const avgRating = gameState.successCount > 0 ? Math.round(gameState.totalRating / gameState.successCount * 10) / 10 : 0;
    document.getElementById('avgRating').textContent = avgRating;
}

function saveGameState() {
    localStorage.setItem('beastFeastRollCount', gameState.rollCount.toString());
    localStorage.setItem('beastFeastSuccessCount', gameState.successCount.toString());
    localStorage.setItem('beastFeastTotalRating', gameState.totalRating.toString());
    localStorage.setItem('beastFeastGroupLevel', gameState.groupLevel.toString());
    localStorage.setItem('beastFeastCharacters', JSON.stringify(gameState.characters));
    localStorage.setItem('beastFeastInventory', JSON.stringify(gameState.inventory));
    localStorage.setItem('beastFeastCookbook', JSON.stringify(gameState.cookbook));
}

function setupEventListeners() {
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ —ñ–Ω–ø—É—Ç—ñ–≤
    Object.keys(diceTypes).forEach(flavor => {
        document.getElementById(flavor).addEventListener('input', updatePrediction);
    });
    document.getElementById('token').addEventListener('input', updatePrediction);
    
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –∑—ñ –∑–≤—ñ—Ä—ñ–≤
    document.getElementById('beastWounds').addEventListener('input', function() {
        const wounds = parseInt(this.value) || 4;
        let count = 1;
        if (wounds >= 12) count = 4;
        else if (wounds >= 8) count = 3;
        else if (wounds >= 5) count = 2;
        document.getElementById('beastIngredientCount').textContent = `–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤: ${count}`;
    });
    
    // –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω—ñ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            e.preventDefault();
            startCooking();
        }
        if (e.key === 'Escape') {
            closeCharacterModal();
            closeRecipeModal();
            closeInventoryModal();
            closeCharacterSelection();
        }
    });
}

function showNotification(message, type = 'info') {
    const colors = {
        'success': 'bg-green-500',
        'warning': 'bg-yellow-500',
        'error': 'bg-red-500',
        'info': 'bg-blue-500'
    };
    
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg z-50 transform transition-transform duration-300`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
document.addEventListener('DOMContentLoaded', function() {
    const wounds = parseInt(document.getElementById('beastWounds')?.value) || 4;
    let count = 1;
    if (wounds >= 12) count = 4;
    else if (wounds >= 8) count = 3;
    else if (wounds >= 5) count = 2;
    if (document.getElementById('beastIngredientCount')) {
        document.getElementById('beastIngredientCount').textContent = `–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤: ${count}`;
    }
});
</script>
</body>
</html>
